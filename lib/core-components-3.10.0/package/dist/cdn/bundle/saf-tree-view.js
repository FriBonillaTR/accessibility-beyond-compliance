"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@saffron/config"),t=require("tslib"),s=require("@microsoft/fast-web-utilities"),r=require("./tree-item-DNUdje2H.js"),n=require("./fast-element-DOTfrYFb.js"),i=require("./ref-BeTe_0iT.js"),l=require("./slotted-cZBT0SIc.js");require("./apply-mixins-CewQe2EQ.js"),require("./start-end-template-D7dQJgd3.js");class c extends n.FASTElement{constructor(){super(...arguments),this.currentFocused=null,this.handleFocus=e=>{if(!(this.slottedTreeItems.length<1))return e.target===this?(null===this.currentFocused&&(this.currentFocused=this.getValidFocusableItem()),void(null!==this.currentFocused&&r.TreeItem.focusItem(this.currentFocused))):void(this.contains(e.target)&&(this.setAttribute("tabindex","-1"),this.currentFocused=e.target))},this.handleBlur=e=>{e.target instanceof HTMLElement&&(null===e.relatedTarget||!this.contains(e.relatedTarget))&&this.setAttribute("tabindex","0")},this.handleKeyDown=e=>{if(e.defaultPrevented)return;if(this.slottedTreeItems.length<1)return!0;const t=this.getVisibleNodes();switch(e.key){case s.keyHome:return void(t.length&&r.TreeItem.focusItem(t[0]));case s.keyEnd:return void(t.length&&r.TreeItem.focusItem(t[t.length-1]));case s.keyArrowLeft:if(e.target&&this.isFocusableElement(e.target)){const t=e.target;t instanceof r.TreeItem&&t.childItemLength>0&&t.expanded?t.expanded=!1:t instanceof r.TreeItem&&t.parentElement instanceof r.TreeItem&&r.TreeItem.focusItem(t.parentElement)}return!1;case s.keyArrowRight:if(e.target&&this.isFocusableElement(e.target)){const t=e.target;t instanceof r.TreeItem&&t.childItemLength>0&&!t.expanded?t.expanded=!0:t instanceof r.TreeItem&&t.childItemLength>0&&this.focusNextNode(1,e.target)}return;case s.keyArrowDown:return void(e.target&&this.isFocusableElement(e.target)&&this.focusNextNode(1,e.target));case s.keyArrowUp:return void(e.target&&this.isFocusableElement(e.target)&&this.focusNextNode(-1,e.target));case s.keyEnter:case s.keySpace:return void this.handleClick(e)}return!0},this.handleSelectedChange=e=>{if(e.defaultPrevented)return;if(!(e.target instanceof Element&&r.isTreeItemElement(e.target)))return!0;const t=e.target;t.selected?(this.currentSelected&&this.currentSelected!==t&&(this.currentSelected.selected=!1),this.currentSelected=t):t.selected||this.currentSelected!==t||(this.currentSelected=null)},this.setItems=()=>{const e=this.treeView.querySelector("[aria-selected='true']");this.currentSelected=e,null!==this.currentFocused&&this.contains(this.currentFocused)||(this.currentFocused=this.getValidFocusableItem())},this.isFocusableElement=e=>r.isTreeItemElement(e),this.isSelectedElement=e=>e.selected}slottedTreeItemsChanged(){this.$fastController.isConnected&&this.setItems()}connectedCallback(){super.connectedCallback(),this.setAttribute("tabindex","0"),n.Updates.enqueue(()=>{this.setItems()})}handleClick(e){if(!(e.target instanceof Element&&r.isTreeItemElement(e.target)))return!0;const t=e.target;t.disabled||(t.selected=!0)}focusNextNode(e,t){const n=this.getVisibleNodes();if(!n)return;const i=n[n.indexOf(t)+e];s.isHTMLElement(i)&&r.TreeItem.focusItem(i)}getValidFocusableItem(){const e=this.getVisibleNodes();let t=e.findIndex(this.isSelectedElement);return-1===t&&(t=e.findIndex(this.isFocusableElement)),-1!==t?e[t]:null}getVisibleNodes(){return s.getDisplayedNodes(this,"[role='treeitem']")||[]}}t.__decorate([n.observable],c.prototype,"currentSelected",void 0),t.__decorate([n.observable],c.prototype,"slottedTreeItems",void 0);exports.default=()=>c.define({name:e.getComponentName("saf-tree-view"),template:n.html`
		<template
			role="tree"
			${i.ref("treeView")}
			@keydown="${(e,t)=>e.handleKeyDown(t.event)}"
			@focusin="${(e,t)=>e.handleFocus(t.event)}"
			@focusout="${(e,t)=>e.handleBlur(t.event)}"
			@click="${(e,t)=>e.handleClick(t.event)}"
			@selected-change="${(e,t)=>e.handleSelectedChange(t.event)}"
		>
			<slot ${l.slotted("slottedTreeItems")}></slot>
		</template>
	`,styles:n.css`
	${e.replaceComponentNamesWithSafAttribute(":host{align-items:stretch;display:flex;flex-direction:column;font-size:4px;min-width:fit-content}:host([hidden]){display:none}:host:focus-visible{outline:none}")}
`,registry:e.getRegistry()});
