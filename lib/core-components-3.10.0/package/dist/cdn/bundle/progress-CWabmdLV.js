"use strict";var e=require("tslib"),t=require("./a11y-DvNZtvTj.js"),n=require("./fast-element-DOTfrYFb.js");const a="loading";class o extends n.FASTElement{constructor(){super(...arguments),this.percentComplete=0,this.statusColor=a,this.completeLabel="complete",this.announce=!1,this.complete=!1,this.previousValue=null,this.valueAnnounced=!1}valueChanged(){this.updatePercentComplete()}minChanged(){this.$fastController.isConnected&&this.updatePercentComplete()}maxChanged(){this.$fastController.isConnected&&this.updatePercentComplete()}connectedCallback(){super.connectedCallback(),this.updatePercentComplete(),this.notifier=n.Observable.getNotifier(this),this.notifier.subscribe(this,"value"),this.notifier.subscribe(this,"announce"),this.announce&&this.setupIndeterminateAnnouncements(),this.previousValue=this.value}updatePercentComplete(){const e="number"==typeof this.min?this.min:0,t="number"==typeof this.max?this.max:100,n="number"==typeof this.value?this.value:0,a=t-e;this.percentComplete=0===a?0:Math.fround((n-e)/a*100)}completeChanged(e,t){t&&!e&&this.handleCompletion()}handleCompletion(){this.completionMessage&&(t.SafA11y.announce(this.completionMessage,"assertive"),this.announce=!1)}setupIndeterminateAnnouncements(){this.clearIndeterminateAnnouncements(),this.isIndeterminate()&&(this.announcementTimeout=setTimeout(()=>{const e=this.ariaLabel?this.ariaLabel:this.label;t.SafA11y.announce(e),this.announcementInterval=setInterval(()=>{t.SafA11y.announce(e)},o.INDETERMINATE_INTERVAL)},o.INDETERMINATE_DELAY))}clearIndeterminateAnnouncements(){this.announcementTimeout&&(clearTimeout(this.announcementTimeout),this.announcementTimeout=null),this.announcementInterval&&(clearInterval(this.announcementInterval),this.announcementInterval=null)}announceValue(){if(!this.valueAnnounced){this.valueAnnounced=!0;const e=`${Math.round(this.percentComplete)}% ${this.completeLabel}`;t.SafA11y.announce(e),setTimeout(()=>{this.valueAnnounced=!1},o.ANNOUNCEMENT_DEBOUNCE)}}disconnectedCallback(){super.disconnectedCallback(),this.notifier.unsubscribe(this,"value"),this.notifier.unsubscribe(this,"announce"),this.clearIndeterminateAnnouncements()}isIndeterminate(){return"number"!=typeof this.value}handleChange(e,t){switch(t){case"value":if(this.announce&&(this.setupIndeterminateAnnouncements(),null!==this.value&&this.announceValue()),null!==this.value&&this.completionMessage){const e="number"==typeof this.max?this.max:100;this.value>=e&&(null===this.previousValue||this.previousValue<e)&&(this.complete=!0),this.previousValue=this.value}break;case"announce":this.announce?this.setupIndeterminateAnnouncements():this.clearIndeterminateAnnouncements()}}}o.INDETERMINATE_INTERVAL=8e3,o.INDETERMINATE_DELAY=2e3,o.ANNOUNCEMENT_DEBOUNCE=4e3,e.__decorate([n.attr({converter:n.nullableNumberConverter})],o.prototype,"value",void 0),e.__decorate([n.attr({converter:n.nullableNumberConverter})],o.prototype,"min",void 0),e.__decorate([n.attr({converter:n.nullableNumberConverter})],o.prototype,"max",void 0),e.__decorate([n.observable],o.prototype,"percentComplete",void 0),e.__decorate([n.attr({attribute:"status-color"})],o.prototype,"statusColor",void 0),e.__decorate([n.attr],o.prototype,"message",void 0),e.__decorate([n.attr],o.prototype,"color",void 0),e.__decorate([n.attr],o.prototype,"indeterminate",void 0),e.__decorate([n.attr({attribute:"complete-label"})],o.prototype,"completeLabel",void 0),e.__decorate([n.attr],o.prototype,"headinglabel",void 0),e.__decorate([n.attr({attribute:"aria-label"})],o.prototype,"ariaLabel",void 0),e.__decorate([n.attr],o.prototype,"label",void 0),e.__decorate([n.attr({attribute:"aria-valuenow"})],o.prototype,"ariaValueNow",void 0),e.__decorate([n.attr({attribute:"aria-valuemin"})],o.prototype,"ariaValueMin",void 0),e.__decorate([n.attr({attribute:"aria-valuemax"})],o.prototype,"ariaValueMax",void 0),e.__decorate([n.attr({attribute:"aria-labelledby"})],o.prototype,"ariaLabelledBy",void 0),e.__decorate([n.attr({mode:"boolean"})],o.prototype,"paused",void 0),e.__decorate([n.attr({attribute:"announce",mode:"boolean"})],o.prototype,"announce",void 0),e.__decorate([n.attr({attribute:"completion-message"})],o.prototype,"completionMessage",void 0),e.__decorate([n.attr({mode:"boolean"})],o.prototype,"complete",void 0),exports.Progress=o;
