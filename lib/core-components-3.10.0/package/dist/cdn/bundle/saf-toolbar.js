"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@saffron/config"),e=require("./saf-divider.js"),s=require("tslib"),o=require("@microsoft/fast-web-utilities"),r=require("tabbable"),a=require("./dom-helpers-DxoVHRyN.js"),i=require("./global-enums-58U8enSy.js"),n=require("./direction-CkR1Fynu.js"),l=require("./fast-element-DOTfrYFb.js"),d=require("./children-DPitos42.js"),c=require("./when-0aDJpnLk.js"),b=require("./slotted-cZBT0SIc.js");const h=Object.freeze({[o.ArrowKeys.ArrowUp]:-1,[o.ArrowKeys.ArrowDown]:1,[o.ArrowKeys.ArrowLeft]:{[o.Direction.ltr]:-1,[o.Direction.rtl]:1},[o.ArrowKeys.ArrowRight]:{[o.Direction.ltr]:1,[o.Direction.rtl]:-1}});class m extends l.FASTElement{constructor(){super(...arguments),this.bottomStartNodes=[],this.bottomEndNodes=[],this.direction=o.Direction.ltr,this.focusableElements=[],this.ariaLabel="Toolbar",this.density=i.ComponentDensityEnum.inherit,this.arrowNav=!1,this._activeIndex=0}childItemsChanged(){this.$fastController.isConnected&&this.setFocusableElements()}get activeIndex(){return l.Observable.track(this,"activeIndex"),this._activeIndex}set activeIndex(t){this.$fastController.isConnected&&(this._activeIndex=o.limit(0,this.focusableElements.length-1,t),l.Observable.notify(this,"activeIndex"))}connectedCallback(){super.connectedCallback(),this.arrowNav&&setTimeout(()=>{this.setFocusableElements(),this.setInitialTabIndexes()}),this.direction=n.getDirection(this)}setInitialTabIndexes(){this.focusableElements.forEach((t,e)=>{e===this.activeIndex?t.setAttribute("tabindex","0"):t.setAttribute("tabindex","-1")})}focus(){this.arrowNav?this.setFocusedElement():super.focus()}bottomStartNodesChanged(){setTimeout(()=>this.ifbottomSlots())}bottomEndNodesChanged(){setTimeout(()=>this.ifbottomSlots())}ifbottomSlots(){return(this.bottomStartNodes.length>0||this.bottomEndNodes.length>0)&&(this.classList.add("twoRows"),!0)}setFocusedElement(t=this.activeIndex){var e;this.activeIndex=t,this.setFocusableElements(),this.focusableElements.forEach((e,s)=>{s===t?e.setAttribute("tabindex","0"):e.setAttribute("tabindex","-1")}),null===(e=this.focusableElements[this.activeIndex])||void 0===e||e.focus()}setFocusableElements(){this.focusableElements=(t=>{const e=t=>Array.from(t.querySelectorAll("*")).map(t=>{const s=r.isFocusable(t),o=a.isSaffronComponent(t);if(s)return t;if(o){const o=e(t.shadowRoot).flat();return 0===o.length&&s?t:o}}).filter(Boolean);return e(t).flat()})(this)}clickHandler(t){if(!this.arrowNav)return!0;let e=this.focusableElements.indexOf(t.composedPath()[0]);return-1===e&&(e=this.focusableElements.indexOf(t.target)),e>-1&&this.activeIndex!==e&&this.setFocusedElement(e),!0}getIncrementer(t){var e,s,r;const{key:a}=t;return a in o.ArrowKeys&&null!==(r=null!==(s=null===(e=h[a])||void 0===e?void 0:e[this.direction])&&void 0!==s?s:h[a])&&void 0!==r?r:0}handleKeyDown(t){if(!this.arrowNav)return!0;if(this.setFocusableElements(),0===this.focusableElements.length)return!0;const e=this.getIncrementer(t),s=this.activeIndex+e;switch(t.key){case o.keyArrowRight:return s>=this.focusableElements.length||this.setFocusedElement(s),!1;case o.keyArrowLeft:return-1===s||this.setFocusedElement(s),!1;case o.keyHome:return this.setFocusedElement(0),!1;case o.keyEnd:return this.setFocusedElement(this.focusableElements.length-1),!1;case o.keyEnter:case o.keySpace:return setTimeout(()=>{this.setFocusedElement()}),!0;default:return!0}}}s.__decorate([l.observable],m.prototype,"bottomStartNodes",void 0),s.__decorate([l.observable],m.prototype,"bottomEndNodes",void 0),s.__decorate([l.observable],m.prototype,"childItems",void 0),s.__decorate([l.observable],m.prototype,"direction",void 0),s.__decorate([l.attr({attribute:"aria-label"})],m.prototype,"ariaLabel",void 0),s.__decorate([l.attr],m.prototype,"density",void 0),s.__decorate([l.attr({attribute:"arrow-nav",mode:"boolean"})],m.prototype,"arrowNav",void 0);exports.default=()=>(e.default(),m.define({name:t.getComponentName("saf-toolbar"),template:l.html`
	<template
		density="${t=>t.density}"
		role="${t=>t.arrowNav?"toolbar":"group"}"
		aria-label="${t=>t.ariaLabel}"
		:dir="${t=>t.direction}"
		@keydown="${(t,e)=>t.handleKeyDown(e.event)}"
		@click="${(t,e)=>t.clickHandler(e.event)}"
		${d.children({property:"childItems",attributeFilter:["disabled","hidden"],selector:"*",subtree:!0})}
	>
		<div class="top-row" part="top-row">
			<slot name="top-row-start"></slot>
			<slot name="top-row-end"></slot>
		</div>
		${c.when(t=>t.ifbottomSlots(),l.html`<saf-divider
				class="separator"
				part="separator"
				orientation="horizontal"
				role="presentation"
			>
			</saf-divider> `)}
		<div class="bottom-row" part="bottom-row">
			<slot name="bottom-row-start" ${b.slotted({property:"bottomStartNodes"})}></slot>
			<slot name="bottom-row-end" ${b.slotted({property:"bottomEndNodes"})}></slot>
		</div>
	</template>
`,styles:l.css`
	${t.replaceComponentNamesWithSafAttribute(':host{color:var(--saf-color-text-heavy);display:block}:host([density=standard]){--saf-density: 0}:host([density=compact]){--saf-density: 1}:host([density=""]){--saf-density: 2}.separator{margin-block:var(--saf-toolbar-separator-margin-block, var(--saf-spacing-4))}.top-row,.bottom-row{justify-content:space-between}.top-row,.bottom-row,::slotted([slot=top-row-start]),::slotted([slot=top-row-end]),::slotted([slot=bottom-row-start]),::slotted([slot=bottom-row-end]){align-items:center;display:flex;flex-wrap:wrap;gap:var(--saf-spacing-3)}@container style(--saf-density: 0){.separator{--saf-toolbar-separator-margin-block: var(--saf-spacing-4)}}@container style(--saf-density: 1){.separator{--saf-toolbar-separator-margin-block: var(--saf-spacing-3)}}@supports(-moz-appearance: none) or (stroke-color: transparent){.separator{--saf-toolbar-separator-margin-block:calc(var(--saf-spacing-4)*(1 - var(--saf-density))*(2 - var(--saf-density))*.5 + var(--saf-spacing-3)*var(--saf-density)*(2 - var(--saf-density)))}}')}
`,registry:t.getRegistry()}));
