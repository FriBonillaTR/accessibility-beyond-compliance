"use strict";var t=require("tslib"),e=require("@microsoft/fast-web-utilities"),i=require("./form-associated-DSP-KUNe.js"),s=require("./fast-element-DOTfrYFb.js"),o=require("./direction-CkR1Fynu.js");class n extends s.FASTElement{}class r extends(i.FormAssociated(n)){constructor(){super(...arguments),this.proxy=document.createElement("input")}}const a="single-value";class h extends r{constructor(){super(...arguments),this.direction=e.Direction.ltr,this.isDragging=!1,this.trackWidth=0,this.trackMinWidth=0,this.trackHeight=0,this.trackLeft=0,this.trackMinHeight=0,this.valueTextFormatter=()=>null,this.min=0,this.max=10,this.orientation=e.Orientation.horizontal,this.mode=a,this.keypressHandler=t=>{if(!this.readOnly&&!this.disabled)if(t.key===e.keyHome)t.preventDefault(),this.direction!==e.Direction.rtl&&this.orientation!==e.Orientation.vertical?this.value=`${this.min}`:this.value=`${this.max}`;else if(t.key===e.keyEnd)t.preventDefault(),this.direction!==e.Direction.rtl&&this.orientation!==e.Orientation.vertical?this.value=`${this.max}`:this.value=`${this.min}`;else if(!t.shiftKey)switch(t.key){case e.keyArrowRight:case e.keyArrowUp:t.preventDefault(),this.increment();break;case e.keyArrowLeft:case e.keyArrowDown:t.preventDefault(),this.decrement()}},this.setupTrackConstraints=()=>{const t=this.track.getBoundingClientRect();this.trackWidth=this.track.clientWidth,this.trackMinWidth=this.track.clientLeft,this.trackHeight=t.top,this.trackMinHeight=t.bottom,this.trackLeft=this.getBoundingClientRect().left,0===this.trackWidth&&(this.trackWidth=1)},this.setupListeners=(t=!1)=>{const e=(t?"remove":"add")+"EventListener";this[e]("keydown",this.keypressHandler),this[e]("mousedown",this.handleMouseDown),this.thumb[e]("mousedown",this.handleThumbMouseDown,{passive:!0}),this.thumb[e]("touchstart",this.handleThumbMouseDown,{passive:!0}),t&&(this.handleMouseDown(null),this.handleThumbMouseDown(null))},this.initialValue="",this.handleThumbMouseDown=t=>{const e=(null!==t?"add":"remove")+"EventListener";window[e]("mouseup",this.handleWindowMouseUp),window[e]("mousemove",this.handleMouseMove,{passive:!0}),window[e]("touchmove",this.handleMouseMove,{passive:!0}),window[e]("touchend",this.handleWindowMouseUp),this.isDragging=null!==t},this.handleMouseMove=t=>{if(this.readOnly||this.disabled||t.defaultPrevented)return;const i=window.TouchEvent&&t instanceof TouchEvent?t.touches[0]:t,s=this.orientation===e.Orientation.horizontal?i.pageX-document.documentElement.scrollLeft-this.trackLeft:i.pageY-document.documentElement.scrollTop;this.value=`${this.calculateNewValue(s)}`},this.handleWindowMouseUp=t=>{this.stopDragging()},this.stopDragging=()=>{this.isDragging=!1,this.handleMouseDown(null),this.handleThumbMouseDown(null)},this.handleMouseDown=t=>{const i=(null!==t?"add":"remove")+"EventListener";if((null===t||!this.disabled&&!this.readOnly)&&(window[i]("mouseup",this.handleWindowMouseUp),window.document[i]("mouseleave",this.handleWindowMouseUp),window[i]("mousemove",this.handleMouseMove),t)){this.setupTrackConstraints();const i=this.orientation===e.Orientation.horizontal?t.pageX-document.documentElement.scrollLeft-this.trackLeft:t.pageY-document.documentElement.scrollTop;this.value=`${this.calculateNewValue(i)}`}},this.required=!1,this.requiredText="*"}static convertPixelToPercent(t,i,s,o){let n=e.limit(0,1,(t-i)/(s-i));return o===e.Direction.rtl&&(n=1-n),n}get valueAsNumber(){return parseFloat(super.value)}set valueAsNumber(t){this.value=t.toString()}valueChanged(t,i){if(this.$fastController.isConnected){const s=parseFloat(i),o=e.limit(this.min,this.max,this.convertToConstrainedValue(s)).toString();if(o!==i)return void(this.value=o);super.valueChanged(t,i),this.setThumbPositionForOrientation(this.direction),this.$emit("change")}}readOnlyChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.readOnly=this.readOnly)}minChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.min=`${this.min}`),this.validate()}maxChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.max=`${this.max}`),this.validate()}stepChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.step=`${this.step}`),this.updateStepMultiplier(),this.validate()}orientationChanged(){this.$fastController.isConnected&&this.setThumbPositionForOrientation(this.direction)}connectedCallback(){super.connectedCallback(),this.proxy.setAttribute("type","range"),this.direction=o.getDirection(this),this.updateStepMultiplier(),this.setupTrackConstraints(),this.setupListeners(),this.setupDefaultValue(),this.setThumbPositionForOrientation(this.direction)}disconnectedCallback(){this.setupListeners(!0)}increment(){const t=(this.direction!==e.Direction.rtl&&(this.orientation,e.Orientation.vertical),Number(this.value)+Number(this.stepValue)),i=this.convertToConstrainedValue(t),s=i<Number(this.max)?`${i}`:`${this.max}`;this.value=s}decrement(){const t=(this.direction!==e.Direction.rtl&&(this.orientation,e.Orientation.vertical),Number(this.value)-Number(this.stepValue)),i=this.convertToConstrainedValue(t),s=i>Number(this.min)?`${i}`:`${this.min}`;this.value=s}get stepValue(){return void 0===this.step?1:this.step}setThumbPositionForOrientation(t){const i=100*(1-h.convertPixelToPercent(Number(this.value),Number(this.min),Number(this.max),t));this.orientation===e.Orientation.horizontal?this.position=this.isDragging?`right: ${i}%; transition: none;`:`right: ${i}%; transition: all 0.2s ease;`:this.position=this.isDragging?`top: ${i}%; transition: none;`:`top: ${i}%; transition: all 0.2s ease;`}updateStepMultiplier(){const t=this.stepValue.toString(),e=this.stepValue%1?t.length-t.indexOf(".")-1:0;this.stepMultiplier=Math.pow(10,e)}get midpoint(){return`${this.convertToConstrainedValue((this.max+this.min)/2)}`}setupDefaultValue(){if("string"==typeof this.value)if(0===this.value.length)this.initialValue=this.midpoint;else{const t=parseFloat(this.value);!Number.isNaN(t)&&(t<this.min||t>this.max)&&(this.value=this.midpoint)}}calculateNewValue(t){this.setupTrackConstraints();const i=h.convertPixelToPercent(t,this.orientation===e.Orientation.horizontal?this.trackMinWidth:this.trackMinHeight,this.orientation===e.Orientation.horizontal?this.trackWidth:this.trackHeight,this.direction),s=(this.max-this.min)*i+this.min;return this.convertToConstrainedValue(s)}convertToConstrainedValue(t){isNaN(t)&&(t=this.min);let e=t-this.min;const i=e-Math.round(e/this.stepValue)*(this.stepMultiplier*this.stepValue)/this.stepMultiplier;return e=i>=Number(this.stepValue)/2?e-i+Number(this.stepValue):e-i,e+this.min}}t.__decorate([s.observable],h.prototype,"direction",void 0),t.__decorate([s.observable],h.prototype,"isDragging",void 0),t.__decorate([s.observable],h.prototype,"position",void 0),t.__decorate([s.observable],h.prototype,"trackWidth",void 0),t.__decorate([s.observable],h.prototype,"trackMinWidth",void 0),t.__decorate([s.observable],h.prototype,"trackHeight",void 0),t.__decorate([s.observable],h.prototype,"trackLeft",void 0),t.__decorate([s.observable],h.prototype,"trackMinHeight",void 0),t.__decorate([s.observable],h.prototype,"valueTextFormatter",void 0),t.__decorate([s.attr({attribute:"readonly",mode:"boolean"})],h.prototype,"readOnly",void 0),t.__decorate([s.attr({converter:s.nullableNumberConverter})],h.prototype,"min",void 0),t.__decorate([s.attr({converter:s.nullableNumberConverter})],h.prototype,"max",void 0),t.__decorate([s.attr({converter:s.nullableNumberConverter})],h.prototype,"step",void 0),t.__decorate([s.attr],h.prototype,"orientation",void 0),t.__decorate([s.attr],h.prototype,"mode",void 0),t.__decorate([s.attr({attribute:"label"})],h.prototype,"label",void 0),t.__decorate([s.attr({attribute:"instructional-text"})],h.prototype,"instructionalText",void 0),t.__decorate([s.attr],h.prototype,"autocomplete",void 0),t.__decorate([s.attr({attribute:"required",mode:"boolean"})],h.prototype,"required",void 0),t.__decorate([s.attr({attribute:"required-text"})],h.prototype,"requiredText",void 0),exports.Slider=h;
