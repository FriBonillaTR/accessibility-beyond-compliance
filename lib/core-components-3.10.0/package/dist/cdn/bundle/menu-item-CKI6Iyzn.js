"use strict";var e=require("tslib"),t=require("@floating-ui/dom"),s=require("@microsoft/fast-web-utilities"),i=require("@saffron/config"),n=require("./apply-mixins-CewQe2EQ.js"),a=require("./start-end-template-D7dQJgd3.js"),o=require("./global-enums-58U8enSy.js"),r=require("./fast-element-DOTfrYFb.js");const u={menuitem:"menuitem",menuitemcheckbox:"menuitemcheckbox",menuitemradio:"menuitemradio"};class d extends r.FASTElement{constructor(){super(...arguments),this.id=s.uniqueId("menu-item-"),this.role=u.menuitem,this.checked=!1,this.focusSubmenuOnLoad=!1,this.handleMenuItemKeyDown=e=>{if(e.defaultPrevented)return!1;switch(e.key===s.keyEscape&&this.expanded&&e.stopPropagation(),e.key){case s.keyEnter:case s.keySpace:return this.disabled||this.dispatchEvent(new MouseEvent("click",{button:0,cancelable:e.cancelable,ctrlKey:e.ctrlKey,metaKey:e.metaKey})),e.key!==s.keySpace;case s.keyArrowRight:return this.expanded&&this.submenu?this.submenu.focus():this.expandAndFocus(),!1;case s.keyEscape:case s.keyArrowLeft:if(this.expanded)return this.closeSubMenu(),!1}return!0},this.navigate=e=>{},this.handleAnchorClick=e=>{const t=e.ctrlKey||e.metaKey||1===e.button||"_blank"===this.target;return!(this.routerLink&&!t)||(this.navigate(this.url),!1)},this.handleMenuItemClick=e=>{if(this.disabled)return!1;const t=e.composedPath().includes(this.anchorElement),s=e.ctrlKey||e.metaKey||1===e.button||this.hasLinkOrRouterLink&&"_blank"===this.target;return t||this.forwardEventToAnchor(e),s||this.setSelectedItem(this),this.hasSubmenu||this.invoke(),!0},this.submenuLoaded=()=>{this.focusSubmenuOnLoad&&(this.focusSubmenuOnLoad=!1,this.submenu&&(this.submenu.focus(),this.setAttribute("tabindex","-1")))},this.handleMouseOver=e=>(this.disabled||!this.hasSubmenu||this.expanded||(this.expanded=!0),!1),this.handleMouseOut=e=>(!this.expanded||this.contains(document.activeElement)||(this.expanded=!1),!1),this.closeSubMenu=()=>{this.expanded=!1,this.focus()},this.expandAndFocus=()=>{this.hasSubmenu&&(this.focusSubmenuOnLoad=!0,this.expanded=!0)},this.invoke=()=>{if(!this.disabled)switch(this.role){case u.menuitemcheckbox:this.checked=!this.checked;break;case u.menuitem:if(this.hasSubmenu){this.expandAndFocus();break}this.$emit("change");break;case u.menuitemradio:this.checked||(this.checked=!0)}},this.hasLink=!1,this.routerLink=!1,this.density=o.ComponentDensityEnum.inherit,this.setSelectedItem=e=>{if(this.hasSubmenu)return;const t=e.parentElement;null==t||t.querySelectorAll(i.getComponentName("saf-menu-item")).forEach(t=>{t===e?t.classList.add("selected"):t.classList.remove("selected")})}}expandedChanged(e,t){this.$fastController.isConnected&&(t&&this.submenu&&this.updateSubmenu(),this.$emit("expanded-change",this,{bubbles:!1})),r.Updates.enqueue(()=>{this.$fastController.isConnected&&this.submenu&&!1===this.expanded&&this.submenu.querySelectorAll(`:scope > ${i.getComponentName("saf-menu-item")}.selected`).forEach(e=>{e.classList.remove("selected")})})}checkedChanged(e,t){this.$fastController.isConnected&&this.$emit("change")}get hasSubmenu(){return!!this.submenu}slottedSubmenuChanged(e,t){t.length&&(this.submenu=t[0],this.updateSubmenu())}disconnectedCallback(){var e;null===(e=this.cleanup)||void 0===e||e.call(this),super.disconnectedCallback()}connectedCallback(){super.connectedCallback(),r.Updates.enqueue(()=>{this.$fastController.isConnected&&(this.target||(this.target=this.routerLink?"_self":"_blank"))})}updateSubmenu(){var s;null===(s=this.cleanup)||void 0===s||s.call(this),this.submenu&&this.expanded&&r.Updates.enqueue(()=>{this.cleanup=t.autoUpdate(this,this.submenuContainer,()=>e.__awaiter(this,void 0,void 0,function*(){const e=["left-start","right-start"],{x:s,y:i}=yield t.computePosition(this,this.submenuContainer,{middleware:[t.size({apply:({availableWidth:t,rects:s})=>{t<s.floating.width&&e.push("bottom-end","top-end")}}),t.flip({fallbackPlacements:e})],placement:"right-start",strategy:"fixed"});Object.assign(this.submenuContainer.style,{left:`${s}px`,position:"fixed",top:`${i}px`}),this.submenuLoaded()}))})}get hasLinkOrRouterLink(){return this.hasLink||this.routerLink}handleMenuItemMouseDown(e){1===e.button&&this.hasLinkOrRouterLink&&e.preventDefault()}handleMenuItemMouseup(e){const t=1===e.button;if(this.disabled||!t)return;t||this.setSelectedItem(this);if(e.composedPath().includes(this.anchorElement))return!0;this.forwardEventToAnchor(e)}handleMenuItemChange(e){if(this.role===u.menuitemradio){e.target.checked||e.stopImmediatePropagation()}}forwardEventToAnchor(e){var t;this.hasLinkOrRouterLink&&this.url&&(e.composedPath().includes(this.anchorElement)||null===(t=this.anchorElement)||void 0===t||t.dispatchEvent(new MouseEvent("click",{button:e instanceof MouseEvent?e.button:0,cancelable:e.cancelable,ctrlKey:e.ctrlKey,metaKey:e.metaKey})))}}e.__decorate([r.attr],d.prototype,"id",void 0),e.__decorate([r.attr({mode:"boolean"})],d.prototype,"disabled",void 0),e.__decorate([r.attr({mode:"boolean"})],d.prototype,"expanded",void 0),e.__decorate([r.attr],d.prototype,"role",void 0),e.__decorate([r.attr({mode:"boolean"})],d.prototype,"checked",void 0),e.__decorate([r.attr({mode:"boolean"})],d.prototype,"hidden",void 0),e.__decorate([r.observable],d.prototype,"slottedSubmenu",void 0),e.__decorate([r.observable],d.prototype,"submenu",void 0),e.__decorate([r.observable],d.prototype,"navigate",void 0),e.__decorate([r.attr({attribute:"url"})],d.prototype,"url",void 0),e.__decorate([r.attr({attribute:"has-link",mode:"boolean"})],d.prototype,"hasLink",void 0),e.__decorate([r.attr({attribute:"router-link",mode:"boolean"})],d.prototype,"routerLink",void 0),e.__decorate([r.attr({attribute:"link-target"})],d.prototype,"target",void 0),e.__decorate([r.attr],d.prototype,"density",void 0),n.applyMixins(d,a.StartEnd),exports.MenuItem=d,exports.MenuItemRoleEnum=u;
