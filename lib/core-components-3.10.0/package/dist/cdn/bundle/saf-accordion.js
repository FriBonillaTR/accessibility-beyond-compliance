"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@saffron/config"),t=require("tslib"),i=require("@microsoft/fast-web-utilities"),s=require("./accordion-item-YZU1nbc3.js"),n=require("./global-enums-58U8enSy.js"),d=require("./fast-element-DOTfrYFb.js"),o=require("./slotted-cZBT0SIc.js");require("./apply-mixins-CewQe2EQ.js"),require("./start-end-template-D7dQJgd3.js"),require("./ref-BeTe_0iT.js");const a="single",r="multi";class c extends d.FASTElement{constructor(){super(...arguments),this.expandmode=r,this.activeItemIndex=0,this.change=()=>{this.$emit("change",this.activeid)},this.setItems=()=>{if(0===this.slottedAccordionItems.length)return;const e=Array.from(this.children);if(this.removeItemListeners(e),e.forEach(e=>d.Observable.getNotifier(e).subscribe(this,"disabled")),this.accordionItems=e.filter(e=>!e.hasAttribute("disabled")),this.accordionIds=this.getItemIds(),this.accordionItems.forEach((e,t)=>{e instanceof s.AccordionItem&&(e.addEventListener("toggle",this.activeItemChange),d.Observable.getNotifier(e).subscribe(this,"expanded"));const i=this.accordionIds[t];e.setAttribute("id","string"!=typeof i?`accordion-${t+1}`:i),this.activeid=this.accordionIds[this.activeItemIndex],e.addEventListener("keydown",this.handleItemKeyDown),e.addEventListener("focus",this.handleItemFocus)}),this.isSingleExpandMode()){const e=this.findExpandedItem();this.setSingleExpandMode(e)}},this.removeItemListeners=e=>{e.forEach((e,t)=>{d.Observable.getNotifier(e).unsubscribe(this,"disabled"),d.Observable.getNotifier(e).unsubscribe(this,"expanded"),e.removeEventListener("toggle",this.activeItemChange),e.removeEventListener("keydown",this.handleItemKeyDown),e.removeEventListener("focus",this.handleItemFocus)})},this.activeItemChange=e=>{e.defaultPrevented||e.target!==e.currentTarget||(e.preventDefault(),this.handleExpandedChange(e.target))},this.handleExpandedChange=e=>{e instanceof s.AccordionItem&&(this.activeid=e.getAttribute("id"),this.isSingleExpandMode()?this.setSingleExpandMode(e):(e.expanded=!e.expanded,this.activeItemIndex=this.accordionItems.indexOf(e)),this.change())},this.handleItemKeyDown=e=>{if(e.target===e.currentTarget)switch(this.accordionIds=this.getItemIds(),e.key){case i.keyArrowUp:e.preventDefault(),this.adjust(-1);break;case i.keyArrowDown:e.preventDefault(),this.adjust(1);break;case i.keyHome:this.activeItemIndex=0,this.focusItem();break;case i.keyEnd:this.activeItemIndex=this.accordionItems.length-1,this.focusItem()}},this.handleItemFocus=e=>{if(e.target===e.currentTarget){const t=e.target,i=this.activeItemIndex=Array.from(this.accordionItems).indexOf(t);this.activeItemIndex!==i&&-1!==i&&(this.activeItemIndex=i,this.activeid=this.accordionIds[this.activeItemIndex])}},this.density=n.ComponentDensityEnum.inherit}expandmodeChanged(e,t){if(!this.$fastController.isConnected)return;const i=this.findExpandedItem();i&&(t!==a?null==i||i.expandbutton.removeAttribute("aria-disabled"):this.setSingleExpandMode(i))}slottedAccordionItemsChanged(e,t){this.$fastController.isConnected&&this.setItems()}handleChange(e,t){"disabled"===t?this.setItems():"expanded"===t&&e.expanded&&this.isSingleExpandMode()&&this.setSingleExpandMode(e)}findExpandedItem(){var e;return this.accordionItems?0===this.accordionItems.length?null:null!==(e=this.accordionItems.find(e=>e instanceof s.AccordionItem&&e.expanded))&&void 0!==e?e:this.accordionItems[0]:null}setSingleExpandMode(e){if(0===this.accordionItems.length)return;const t=Array.from(this.accordionItems);this.activeItemIndex=t.indexOf(e),t.forEach((e,t)=>{this.activeItemIndex===t?(e.expanded=!0,e.expandbutton.setAttribute("aria-disabled","true")):(e.expanded=!1,e.hasAttribute("disabled")||e.expandbutton.removeAttribute("aria-disabled"))})}getItemIds(){return this.slottedAccordionItems.map(e=>e.id)}isSingleExpandMode(){return this.expandmode===a}adjust(e){this.activeItemIndex=i.wrapInBounds(0,this.accordionItems.length-1,this.activeItemIndex+e),this.focusItem()}focusItem(){const e=this.accordionItems[this.activeItemIndex];e instanceof s.AccordionItem&&e.expandbutton.focus()}}t.__decorate([d.attr({attribute:"expand-mode"})],c.prototype,"expandmode",void 0),t.__decorate([d.observable],c.prototype,"slottedAccordionItems",void 0),t.__decorate([d.attr],c.prototype,"density",void 0);exports.default=()=>c.define({name:e.getComponentName("saf-accordion"),template:d.html`
		<slot ${o.slotted({property:"slottedAccordionItems",filter:o.elements()})}></slot>
	`,styles:d.css`
	${e.replaceComponentNamesWithSafAttribute(':host{box-sizing:border-box;display:block}:host([density=standard]){--saf-density: 0}:host([density=compact]){--saf-density: 1}:host([density=""]){--saf-density: 2}')}
`,registry:e.getRegistry()}),exports.safAccordionConfig={events:{onChange:"change"}};
