"use strict";var t=require("@saffron/config"),e=require("tslib"),i=require("./global-enums-58U8enSy.js"),o=require("./fast-element-DOTfrYFb.js"),s=require("@floating-ui/dom"),r=require("@microsoft/fast-web-utilities"),n=require("./a11y-DvNZtvTj.js"),a=require("./logger-vjs750p7.js"),l=require("./dom-helpers-DxoVHRyN.js");class h extends o.FASTElement{constructor(){super(...arguments),this.handleClick=t=>{const e=t.composedPath();e.includes(this)||this.$emit("click-away",e)},this.density=i.ComponentDensityEnum.inherit}connectedCallback(){super.connectedCallback(),document.addEventListener("click",this.handleClick)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleClick)}}e.__decorate([o.attr],h.prototype,"density",void 0);const c=()=>h.define({name:t.getComponentName("saf-click-away-listener"),template:o.html`
	<template>
		<slot></slot>
	</template>
`,styles:o.css`
	${t.replaceComponentNamesWithSafAttribute(':host([density=standard]){--saf-density: 0}:host([density=compact]){--saf-density: 1}:host([density=""]){--saf-density: 2}')}
`,registry:t.getRegistry()});class d extends o.FASTElement{constructor(){super(...arguments),this._visible=!1,this.anchorElement=null,this.triggerOnClick=!1,this.controlledVisibility=!1,this._mouseOver=!1,this.focusoutAnchorHandler=()=>{this.controlledVisibility||!this._visible||this._mouseOver||this.hideTooltip()},this.focusinAnchorHandler=()=>{var t;this.controlledVisibility||this._visible||(null===(t=this.anchorElement)||void 0===t||t.focus(),this.showTooltip())},this.keydownDocumentHandler=t=>{!t.defaultPrevented&&this.visible&&t.key===r.keyEscape&&this.dismiss()},this.mouseoverAnchorHandler=()=>{var t;(null===(t=l.getRootActiveElement(this))||void 0===t?void 0:t.isSameNode(this.anchorElement))||this.showTooltip(),this._mouseOver=!0},this.mouseoutAnchorHandler=t=>{var e;(null===(e=l.getRootActiveElement(this))||void 0===e?void 0:e.isSameNode(this.anchorElement))||this.isSameNode(t.relatedTarget)||this.hideTooltip(),this._mouseOver=!1},this.clickAnchorHandler=t=>{var e;t.stopPropagation(),this.controlledVisibility||(this._visible?this.hideTooltip():(null===(e=this.anchorElement)||void 0===e||e.focus(),this.showTooltip()))},this.blurAnchorHandler=()=>{o.Updates.enqueue(()=>{!this.controlledVisibility&&this._visible&&(document.activeElement===this||document.activeElement===this.anchorElement||this.contains(document.activeElement)||this.anchorElement&&this.anchorElement.contains(document.activeElement)||this.hideTooltip())})},this.placement="bottom",this.onFocusIn=()=>{this.setAttribute("anchor-focused","true")},this.onFocusOut=()=>{this.setAttribute("anchor-focused","false")}}anchorChanged(t,e){this.$fastController.isConnected&&e&&(this.removeListeners(),this.removeAnchorAriaDescribedBy(this.id),this.anchorElement=this.getAnchorElement(e),this.addAnchorAriaDescribedBy(),this.controlledVisibility||this.addListeners())}triggerOnClickChanged(){this.$fastController.isConnected&&(this.removeListeners(),this.addListeners())}controlledVisibilityChanged(t,e){if(t&&!e)return this.addListeners(),void this.hideTooltip();e&&this.removeListeners()}idChanged(t,e){this.addListenersTimeout&&clearTimeout(this.addListenersTimeout),this.removeAnchorAriaDescribedBy(t),o.Updates.enqueue(()=>{this.addAnchorAriaDescribedBy()})}handleOutsideClick(t){this.triggerOnClick&&this.hideTooltip()}positionStylesChanged(t,e){this.$fastController.removeStyles(t),this.$fastController.addStyles(e)}showChanged(t,e){this.setVisible(e)}get visible(){return this._visible}setVisible(t){this.controlledVisibility="boolean"==typeof t,this.controlledVisibility&&(this.show=t),t?this.showTooltip():this.hideTooltip()}addAnchorAriaDescribedBy(){var t;if(!this.id)return void(this.id=r.uniqueId("tooltip-"));if(!this.anchorElement)return;const e=null===(t=this.anchorElement.getAttribute("aria-describedby"))||void 0===t?void 0:t.concat(" ",this.id).trim();e&&this.anchorElement.setAttribute("aria-describedby",e)}addListeners(t=0){if(!this.anchorElement&&t<5)return a.Logger.warn(`Tooltip with ID "${this.id}": anchor element not found. Try #${t+1}. Retrying in ${200*t}ms.`,"This is usually indicative of a wrong rendering order; ensure that the anchor element is rendered before the tooltip."),void(this.addListenersTimeout=setTimeout(()=>{this.anchorElement=this.getAnchorElement(this.anchor),this.addListeners(t+1)},200*t));this.anchorElement?(this.triggerOnClick?(this.anchorElement.addEventListener("click",this.clickAnchorHandler),this.anchorElement.addEventListener("blur",this.blurAnchorHandler)):(this.anchorElement.addEventListener("focus",this.focusinAnchorHandler),this.anchorElement.addEventListener("focusout",this.focusoutAnchorHandler),this.anchorElement.addEventListener("mouseout",this.mouseoutAnchorHandler),this.anchorElement.addEventListener("mouseover",this.mouseoverAnchorHandler),this.addEventListener("mouseout",this.mouseoutAnchorHandler),this.addEventListener("mouseover",this.mouseoverAnchorHandler)),this.anchorElement.addEventListener("focus",this.onFocusIn),this.anchorElement.addEventListener("focusout",this.onFocusOut),document.addEventListener("keydown",this.keydownDocumentHandler)):a.Logger.error(`Tooltip with ID "${this.id}": anchor element ${this.anchor?`with ID "${this.anchor}" `:""}not found after 5 retries`)}connectedCallback(){var t;super.connectedCallback(),this.anchorChanged(void 0,this.anchor);const e=()=>{this.hideTimeout&&clearTimeout(this.hideTimeout)};null===(t=this.anchorElement)||void 0===t||t.addEventListener("mouseover",e),this.addEventListener("mouseover",e)}dismiss(){this.hideTooltip(),this.$emit("dismiss",null,{bubbles:!1})}getAnchorElement(t=""){const e=this.getRootNode();return e instanceof ShadowRoot?e.getElementById(t):document.getElementById(t)}removeAnchorAriaDescribedBy(t){var e;if(this.anchorElement){const i=null===(e=this.anchorElement.getAttribute("aria-describedby"))||void 0===e?void 0:e.split(" ");this.anchorElement.setAttribute("aria-describedby",(null!=i?i:[]).filter(e=>e!==t).join(" ")),""===this.anchorElement.getAttribute("aria-describedby")&&this.anchorElement.removeAttribute("aria-describedby")}}removeListeners(){this.anchorElement&&(this.anchorElement.removeEventListener("focus",this.focusinAnchorHandler),this.anchorElement.removeEventListener("focusout",this.focusoutAnchorHandler),this.anchorElement.removeEventListener("mouseout",this.mouseoutAnchorHandler),this.anchorElement.removeEventListener("mouseover",this.mouseoverAnchorHandler),this.anchorElement.removeEventListener("click",this.clickAnchorHandler),this.anchorElement.removeEventListener("blur",this.blurAnchorHandler),this.anchorElement.removeEventListener("focus",this.onFocusIn),this.anchorElement.removeEventListener("focusout",this.onFocusOut),this.removeEventListener("mouseout",this.mouseoutAnchorHandler),this.removeEventListener("mouseover",this.mouseoverAnchorHandler),document.removeEventListener("keydown",this.keydownDocumentHandler))}showTooltip(){this._visible=!0,o.Updates.enqueue(()=>this.setPositioning())}hideTooltip(){this.hideTimeout=setTimeout(()=>{var t;this.show||(this._visible=!1,null===(t=this.cleanup)||void 0===t||t.call(this))},150)}disconnectedCallback(){super.disconnectedCallback(),this.removeListeners()}setPositioning(){var t;if(this.triggerOnClick&&n.SafA11y.announce(this.textContent),null===(t=this.cleanup)||void 0===t||t.call(this),!this.anchorElement)return void this.hideTooltip();const i=this.anchorElement;this.cleanup=s.autoUpdate(i,this,()=>e.__awaiter(this,void 0,void 0,function*(){var t,e,r;let{x:n,y:a,placement:l,middlewareData:h}=yield s.computePosition(i,this,{placement:this.placement,strategy:"fixed",middleware:[s.flip(),s.shift({mainAxis:!1})]});const c=()=>o.css`
					:host {
						position: fixed;
						left: ${n.toString()}px;
						top: ${a.toString()}px;
					}
				`,d=(t,e)=>"y"===t?o.css`
						${c()}
						:host([placement='left'])::after,
						:host([placement='right'])::after {
							top: ${e}%;
							transform: translateY(-${e}%) rotate(45deg);
						}
					`:o.css`
					${c()}
					:host([placement='top'])::after,
					:host([placement='bottom'])::after {
						left: ${e}%;
						transform: translateX(-${e}%) rotate(45deg);
					`;this.placement=l;const m=null===(t=this.anchorElement)||void 0===t?void 0:t.clientWidth;if(m&&m<20){const t=this.anchorElement.clientWidth/2-14;l.includes("start")?n+=t:l.includes("end")&&(n-=t)}const u=null===(e=h.shift)||void 0===e?void 0:e.x,p=null===(r=h.shift)||void 0===r?void 0:r.y;if(p&&(l.includes("right")||l.includes("left"))){const t=""+(50-parseInt(String(p/this.clientHeight*100),10));this.positionStyles=d("y",t)}else if(u&&(l.includes("top")||l.includes("bottom"))){const t=""+(50-parseInt(String(u/this.clientWidth*100),10));this.positionStyles=d("x",t)}else this.positionStyles=c()}))}}e.__decorate([o.observable],d.prototype,"_visible",void 0),e.__decorate([o.attr({attribute:"anchor"})],d.prototype,"anchor",void 0),e.__decorate([o.attr({mode:"boolean",attribute:"trigger-on-click"})],d.prototype,"triggerOnClick",void 0),e.__decorate([o.observable],d.prototype,"controlledVisibility",void 0),e.__decorate([o.attr],d.prototype,"placement",void 0),e.__decorate([o.observable],d.prototype,"positionStyles",void 0),e.__decorate([o.attr({attribute:"show",converter:o.nullableBooleanConverter,mode:"fromView"})],d.prototype,"show",void 0);exports.ClickAwayListenerDefine=c,exports.SafTooltip=()=>(c(),d.define({name:t.getComponentName("saf-tooltip"),template:o.html` <template role="tooltip" ?visible="${t=>t.visible}">
		<saf-click-away-listener
			@click-away="${(t,e)=>t.handleOutsideClick(e.event)}"
		>
			<slot></slot>
		</saf-click-away-listener>
	</template>`,styles:o.css`
	${t.replaceComponentNamesWithSafAttribute(':host{background:var(--saf-color-status-neutral-strong);border-radius:var(--saf-border-radius-xs);box-shadow:var(--saf-drop-shadow-level-2);box-sizing:border-box;color:var(--saf-color-status-neutral-subtle);display:block;font:var(--saf-type-body-default-sm-regular-standard);height:fit-content;max-width:200px;min-width:70px;overflow-wrap:break-word;padding:var(--saf-spacing-2) var(--saf-spacing-4);position:fixed;text-align:center;visibility:hidden;white-space:initial;width:max-content;z-index:var(--saf-z-index-tooltip)}:host([anchor-focused=true]){z-index:var(--saf-z-index-tooltip-focus)}:host([placement=right]){margin-left:var(--saf-spacing-3)}:host([placement=left]){margin-left:calc(var(--saf-spacing-3)*-1)}:host([placement=top]),:host([placement=top-start]),:host([placement=top-end]){margin-top:calc(var(--saf-spacing-3)*-1)}:host([placement=bottom]),:host([placement=bottom-start]),:host([placement=bottom-end]){margin-top:var(--saf-spacing-3)}:host([hidden]){display:none}:host([visible]){opacity:1;transition:visibility 0s 0s linear,opacity .25s .25s linear;visibility:visible}:host(:not([visible])){display:none;opacity:0;transition:visibility 0s .25s,opacity .25s linear;visibility:hidden}:host([show=true][visible]){transition:none}:host::after{background:var(--saf-color-status-neutral-strong);border-radius:2px;box-sizing:border-box;content:"";height:12px;position:absolute;width:12px}:host([placement=bottom])::after,:host([placement=top])::after{left:50%;transform:translateX(-50%) rotate(45deg)}:host([placement=top-start])::after,:host([placement=bottom-start])::after{left:8px;transform:rotate(45deg)}:host([placement=top-end])::after,:host([placement=bottom-end])::after{right:8px;transform:rotate(45deg)}:host([placement=left])::after,:host([placement=right])::after{top:50%;transform:translateY(-50%) rotate(45deg)}:host([placement=bottom])::after,:host([placement=bottom-start])::after,:host([placement=bottom-end])::after{top:-5px}:host([placement=top])::after,:host([placement=top-start])::after,:host([placement=top-end])::after{bottom:-5px}:host([placement=right])::after{left:-5px}:host([placement=left])::after{right:-5px}:host([trigger-on-click]){background-color:var(--saf-color-background-subtle);border:var(--saf-line-width-thin) solid var(--saf-color-border-stronger);color:var(--saf-color-text-strong);text-align:left}:host([trigger-on-click])::after{background-color:inherit;border:inherit}:host([trigger-on-click][placement=bottom])::after,:host([trigger-on-click][placement=bottom-start])::after,:host([trigger-on-click][placement=bottom-end])::after{border-bottom-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);top:-6px}:host([trigger-on-click][placement=top])::after,:host([trigger-on-click][placement=top-start])::after,:host([trigger-on-click][placement=top-end])::after{border-left-color:rgba(0,0,0,0);border-top-color:rgba(0,0,0,0);bottom:-6px}:host([trigger-on-click][placement=right])::after{border-right-color:rgba(0,0,0,0);border-top-color:rgba(0,0,0,0);left:-6px}:host([trigger-on-click][placement=left])::after{border-bottom-color:rgba(0,0,0,0);border-left-color:rgba(0,0,0,0);right:-6px}')}
`,registry:t.getRegistry()})),exports.safTooltipConfig={events:{onDismiss:"dismiss"}};
